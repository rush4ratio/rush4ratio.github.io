<!DOCTYPE>
<html>
<head>
    <link rel="stylesheet" href="css/style-min.css"/>
    <title>9-Mezz | Contact Us</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<nav>
    <ul class="main-nav clearfix"><!--

	 --><li class="main-nav__item"><a href="index.html">Home</a></li><!--
		 --><li class="main-nav__item"><a href="what-we-do.html">What We Do</a></li><!--
		     	 --><li class="main-nav--logo"><a href="index.html"><div></div><!--<img src="img/logo7.png">--></a></li><!--
		 --><li class="main-nav__item"><a href="team.html">Team</a></li><!--
	     --><li class="main-nav__item"><a href="#">Contact</a></li><!--
	--></ul>
</nav>
<div class="main clearfix">
    <aside class="sub-content sub-content--contact">
        <h2 class="sub-content__welcome">Welcome! We're 9-Mezz Consultants.</h2>
    </aside>
    <section class="main-content main-content--contact">
        <form id="contact_form">
            <label for="name">Name</label><input type="text" id='name'/>
            <label for="name">Email</label><input type="email" id='email'/>
            <label for="name">Phone</label><input type="tel" id='telephone'/>
            <fieldset class="checkbox-group">
                <legend>What can we do for you?</legend>
                <input class="checkbox-group--item" type="checkbox" name="new-website" value="New website" />A New Website <br />
                <input class="checkbox-group--item" type="checkbox" name="website-redesign" value="Redesign my website" />Redesign your Website<br />
                <input class="checkbox-group--item" type="checkbox" name="newsletter" value="Start a Newsletter" />Newsletters<br />
                <input class="checkbox-group--item" type="checkbox" name="brochure" value="Brochures" />Brochures
            </fieldset>
            <label for="message">Special Note</label><textarea id='message'></textarea>
            <label for="budget">Budget (Kshs)</label><input id='budget' type="range" min="50000" max="150000" value="0" step="10000" onchange="showValue(this.value)" />
            <span id="range" class="form--range">below 50000</span>
            <button type="submit">Send</button>
        </form>
        <div class="message__response"></div>
    </section>
</div>
<footer class="footer">
    <p>&copy; 9-Mezz 2015</p>
</footer>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script type="text/javascript">
    function showValue(newValue)
    {
        if(newValue<50000){
            document.getElementById("range").innerHTML = "below " + newValue;
        }

        else if (newValue>=150000){
            document.getElementById("range").innerHTML = "above " + newValue;
        }
        else{
            document.getElementById("range").innerHTML=newValue;
        }
    }

    $(document).ready(function(){
        sendEmail();

    });

    function sendEmail(){
        $('#contact_form').submit(function(e) {
            e.preventDefault();

            var name = $('#name').val();
            var email = $('#email').val();
            var telephone = $('#telephone').val();
            var message = $('#message').val();
            var budget = $('#budget').val().toLocaleString();
            var services = [];

            $.each($('input:checked'), function () {
                services.push($(this).val());
            });

            var service_interests = services.join(", ");


            var mail_message =
                    "Name: " + name + '\n\n' +
                    "Email: " + email +  '\n\n' +
                    "Phone: " + telephone + '\n\n' +
                    "Message: " + message + '\n\n' +
                    "Budget: " + budget + '\n\n' +
                    "Service interests: " + service_interests + '\n\n';

            $.ajax({
                type: "POST",
                url: "https://mandrillapp.com/api/1.0/messages/send.json",
                data: {
                    'key': '1PGtiJtCpDwpAPL6-L5Aqg',
                    'message': {
                        'from_email': 'website@nine-mezz.co.ke',
                        'to': [
                            {
                                'email': 'nine.mezz.consultants@gmail.com',
                                'name': 'INFO',
                                'type': 'to'
                            }
                        ],
                        'subject': 'QUERY',
                        'text': mail_message
                    }
                }
            })
                    .done(successFn)
                    .fail(errorFn)
                    .always(function (data, textStatus, jqXHR){
                        console.log("The Request is complete");
                    });


        });
    }

    function successFn(data, status, jqXHR) {
        console.log("Setting result");
        $(".message__response").addClass("message__response--visible");
        $(".message__response").append("Message sent successfully. We will contact you soon.");
    }

    function errorFn(xhr, status, strErr) {
        $(".message__response").addClass("message__response--failed");
        $(".message__response").append("Message failed to send.");
        console.log("There was an error!");
    }

</script>
</body>
</html>